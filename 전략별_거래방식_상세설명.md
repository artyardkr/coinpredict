# ElasticNet 백테스팅 전략별 거래 방식 상세 설명

**작성일**: 2025년 11월 12일
**분석 대상**: step26_elasticnet_backtesting_v2.py

---

## 📌 전략 목록

```python
strategies = [
    ('Buy-and-Hold', None, None),
    ('Long-Only (ElasticNet)', 'long_only', 0.0),
    ('Long-Short (ElasticNet)', 'long_short', 0.0),
    ('Threshold 1% (ElasticNet)', 'threshold', 1.0),
    ('Threshold 2% (ElasticNet)', 'threshold', 2.0),
]
```

**파라미터 의미**:
- 첫 번째: 전략 이름
- 두 번째: 전략 타입 (`strategy_type`)
- 세 번째: 임계값 (`threshold`, %)

---

## 1️⃣ Buy-and-Hold (기준선)

### 전략 개요
가장 단순한 전략. 처음에 Bitcoin을 매수하고 끝까지 보유.

### 거래 방식
```python
# 초기: 매수
initial_price = $10,000
# 매일: 아무것도 안함 (보유만)
# 최종: 현재 가격으로 평가
final_price = $17,191
```

### 특징
- ✅ 거래 횟수: **0회** (수수료 없음)
- ✅ 단순함: 아무것도 안 해도 됨
- ❌ 하락장에서도 손실 감수
- ❌ 변동성 그대로 노출

### 결과 (V2)
- 총 수익률: **71.91%**
- 샤프 비율: 1.231
- 최대 낙폭: **-28.14%**

---

## 2️⃣ Long-Only (ElasticNet)

### 전략 개요
ElasticNet이 **상승 예측** → 매수 보유
ElasticNet이 **하락 예측** → 현금 보유 (매도)

### 거래 로직
```python
# 1. 예측 변화율 계산
predicted_change_pct = (예측가격 - 현재가격) / 현재가격 * 100

# 2. 거래 결정
if predicted_change_pct > 0:  # 상승 예측
    if 현재 포지션 != 'long':
        매수  # Long 진입
    else:
        보유  # Long 유지
else:  # 하락 예측 (predicted_change_pct <= 0)
    if 현재 포지션 == 'long':
        매도  # Long 청산 → 현금 보유
```

### 구체적 예시
```
Day 1: 예측 +2.5% → 매수 (Long 진입)
Day 2: 예측 +1.0% → 보유 (Long 유지)
Day 3: 예측 -0.5% → 매도 (현금 전환) ← 하락 예측이지만 공매도는 안 함!
Day 4: 예측 -1.0% → 대기 (현금 보유)
Day 5: 예측 +0.1% → 매수 (Long 재진입)
```

### 특징
- ✅ 상승장만 참여 (안전)
- ✅ 하락장에는 현금 보유 (손실 회피)
- ❌ **공매도 없음** (Short 금지)
- ⚠️ 작은 예측 변화에도 반응 (잦은 거래)

### 결과 (V2)
- 총 수익률: **122.56%**
- 샤프 비율: 2.571
- 최대 낙폭: -17.18%
- 거래 횟수: **37회** (월 3회)

---

## 3️⃣ Long-Short (ElasticNet)

### 전략 개요
ElasticNet이 **상승 예측** → 매수 (Long)
ElasticNet이 **하락 예측** → 공매도 (Short)

### 거래 로직
```python
# 1. 예측 변화율 계산
predicted_change_pct = (예측가격 - 현재가격) / 현재가격 * 100

# 2. 거래 결정
if predicted_change_pct > 0:  # 상승 예측
    if 현재 포지션 == 'short':
        숏 청산  # Short 종료
    매수  # Long 진입
    보유  # Long 유지

else:  # 하락 예측 (predicted_change_pct <= 0)
    if 현재 포지션 == 'long':
        롱 청산  # Long 종료
    공매도  # Short 진입
    보유  # Short 유지
```

### 구체적 예시
```
Day 1: 예측 +2.5% → Long 진입 (매수)
Day 2: 예측 +1.0% → Long 유지
Day 3: 예측 -0.5% → Long 청산 → Short 진입 (공매도) ⚠️
Day 4: 예측 -1.0% → Short 유지
Day 5: 예측 +0.1% → Short 청산 → Long 재진입
```

### 공매도(Short) 수익 계산
```python
# Short 진입: $10,000에 공매도
entry_price = $10,000

# Short 유지 중 가격 하락
next_price = $9,500

# 수익 계산 (가격 하락 시 수익!)
profit = entry_price / next_price - 1
      = $10,000 / $9,500 - 1
      = 5.26% 수익
```

### 특징
- ✅ **양방향 수익** (상승장 + 하락장 모두)
- ✅ 시장 방향 무관하게 수익 추구
- ✅ 최고 수익률 (V1: 207.97%, V2: 188.12%)
- ⚠️ **큰 낙폭** (-21-27%)
- ⚠️ 공매도 위험 (무한 손실 가능성)
- ⚠️ 매우 잦은 거래 (36-38회)

### 결과 (V2)
- 총 수익률: **188.12%** (최고!)
- 샤프 비율: 2.954
- 최대 낙폭: **-21.66%** (큼!)
- 거래 횟수: **38회** (월 3회)

---

## 4️⃣ Threshold 1% (ElasticNet)

### 전략 개요
**확신도 높은 예측만** 거래.
예측 변화율이 **±1% 이상**일 때만 포지션 진입.

### 거래 로직
```python
# 1. 예측 변화율 계산
predicted_change_pct = (예측가격 - 현재가격) / 현재가격 * 100

# 2. 거래 결정
threshold = 1.0  # 1%

if predicted_change_pct > threshold:  # +1% 이상 상승 예측
    매수  # Long 진입

elif predicted_change_pct < -threshold:  # -1% 이상 하락 예측
    if 현재 포지션 == 'long':
        매도  # Long 청산 → 현금 보유
    # ⚠️ Short는 안 함! (Long-Only와 유사)

else:  # -1% ~ +1% 사이 (불확실)
    대기  # 현금 보유 또는 기존 포지션 유지
```

### 구체적 예시
```
Day 1: 예측 +2.5% (>1%) → 매수 ✅
Day 2: 예측 +0.8% (<1%) → 보유 (기존 Long 유지)
Day 3: 예측 -0.3% (-1%~+1%) → 보유
Day 4: 예측 -1.2% (<-1%) → 매도 ✅ (현금 전환)
Day 5: 예측 -0.5% → 대기 (현금 보유)
Day 6: 예측 +1.5% (>1%) → 매수 ✅
```

### Threshold의 역할
- **Threshold = 1%**: 예측 변화율이 ±1% 이상일 때만 신호
- **목적**: 노이즈 필터링, 확실한 신호만 거래
- **효과**: 거래 빈도 감소 → 거래비용 절감

### 특징
- ✅ **선택적 거래** (확신 있을 때만)
- ✅ 노이즈 감소 (작은 변동 무시)
- ✅ 거래 빈도 중간 (17-25회)
- ⚠️ V2에서 성능 저하 (73.86%, V1 대비 절반)

### 결과 (V2)
- 총 수익률: **73.86%**
- 샤프 비율: 1.670
- 최대 낙폭: -16.42%
- 거래 횟수: **17회** (월 1.5회)

---

## 5️⃣ Threshold 2% (ElasticNet) ⭐ 추천!

### 전략 개요
**매우 확신도 높은 예측만** 거래.
예측 변화율이 **±2% 이상**일 때만 포지션 진입.

### 거래 로직
```python
# 1. 예측 변화율 계산
predicted_change_pct = (예측가격 - 현재가격) / 현재가격 * 100

# 2. 거래 결정
threshold = 2.0  # 2%

if predicted_change_pct > threshold:  # +2% 이상 상승 예측
    매수  # Long 진입

elif predicted_change_pct < -threshold:  # -2% 이상 하락 예측
    if 현재 포지션 == 'long':
        매도  # Long 청산 → 현금 보유

else:  # -2% ~ +2% 사이 (불확실)
    대기  # 거래 안 함
```

### 구체적 예시
```
Day 1-5: 예측 +0.5%, +1.2%, -0.8%, +1.5%, -1.0% → 모두 대기 (|예측| < 2%)
Day 6: 예측 +2.3% (>2%) → 매수 ✅ (Long 진입)
Day 7-10: 예측 +1.8%, +1.2%, +0.5%, -1.5% → 보유 (기존 Long 유지)
Day 11: 예측 -2.5% (<-2%) → 매도 ✅ (현금 전환)
Day 12-20: 예측 -1.8%, -0.5%, +1.0%, ... → 대기 (현금 보유)
Day 21: 예측 +2.8% (>2%) → 매수 ✅
```

### Threshold 2%의 의미
- **매우 높은 확신도**: ±2% 이상 변화 예측은 드물고 중요
- **보수적 접근**: 불확실하면 거래 안 함
- **장기 보유**: 한 번 진입하면 반대 신호 나올 때까지 유지

### 특징
- ✅ **최소 거래** (13-15회, 월 1회)
- ✅ **최소 낙폭** (-13.34%, V2 최고!)
- ✅ **낮은 거래비용 영향** (실전 최적)
- ✅ **안정적 수익** (109.97%, V2)
- ✅ **심리적 안정** (낙폭 작음)
- ⚠️ 기회 놓침 (작은 신호 무시)

### 결과 (V2)
- 총 수익률: **109.97%** ⭐
- 샤프 비율: **2.526** ⭐
- 최대 낙폭: **-13.34%** ⭐ (최소!)
- 거래 횟수: **13회** (월 1회)

---

## 📊 전략 비교 요약

| 전략 | 거래 조건 | Short 여부 | 거래 빈도 | 수익률 | 낙폭 | 추천 대상 |
|------|----------|----------|----------|--------|------|----------|
| **Buy-and-Hold** | 없음 (보유만) | ❌ | 0회 | 71.91% | -28.14% | 장기 투자자 |
| **Long-Only** | 예측 > 0% | ❌ | 37회 | 122.56% | -17.18% | 중간 공격성 |
| **Long-Short** | 항상 포지션 | ✅ | 38회 | **188.12%** | **-21.66%** | 공격적 투자자 |
| **Threshold 1%** | 예측 > ±1% | ❌ | 17회 | 73.86% | -16.42% | 보수적 |
| **Threshold 2%** ⭐ | 예측 > ±2% | ❌ | 13회 | **109.97%** | **-13.34%** ⭐ | 실전 추천! |

---

## 🎯 핵심 차이점 정리

### 1. Long-Only vs Long-Short
- **Long-Only**: 하락 예측 시 **현금 보유** (안전)
- **Long-Short**: 하락 예측 시 **공매도** (공격적, 양방향 수익)

### 2. Long-Only vs Threshold
- **Long-Only**: **모든 상승 예측**에 반응 (예측 +0.01%도 매수)
- **Threshold**: **±Threshold 이상**만 반응 (확신도 필터)

### 3. Threshold 1% vs 2%
- **1%**: 더 민감, 더 많은 거래 (17회)
- **2%**: 더 보수적, 적은 거래 (13회), **더 안정적**

---

## 💡 예측 변화율 계산 방법

### 공식
```python
predicted_change_pct = (predicted_next_price - current_price) / current_price * 100
```

### 예시
```python
# 현재 가격: $70,000
# 예측 가격: $72,100

predicted_change_pct = ($72,100 - $70,000) / $70,000 * 100
                     = $2,100 / $70,000 * 100
                     = 3.0%

# 결과: +3.0% 상승 예측
```

### Threshold 적용
```python
Threshold 1%:
- 예측 +3.0% > 1% → 매수 신호 ✅
- 예측 +0.5% < 1% → 거래 안 함 ❌

Threshold 2%:
- 예측 +3.0% > 2% → 매수 신호 ✅
- 예측 +1.5% < 2% → 거래 안 함 ❌
```

---

## 🚀 실전 적용 예시

### Threshold 2% 전략 (V2, 추천)

**Step 1**: ElasticNet으로 내일 가격 예측
```python
current_price = $70,000
predicted_price = $72,100
predicted_change = +3.0%
```

**Step 2**: Threshold 비교
```python
threshold = 2.0%
predicted_change (+3.0%) > threshold (2.0%) → 매수 신호!
```

**Step 3**: 거래 실행
```python
if 현재 포지션 없음:
    매수 ($70,000에 진입)
    포지션 = 'long'
```

**Step 4**: 다음날
```python
actual_price = $71,500
수익 = ($71,500 / $70,000 - 1) * 100 = +2.14%
```

**Step 5**: 다음 신호까지 보유
```python
Day 2 예측: +1.5% → 보유 (< 2%)
Day 3 예측: +0.8% → 보유 (< 2%)
Day 4 예측: -2.3% → 매도 신호! (< -2%)
```

---

## 📌 거래 방식 책정 근거

### 왜 이런 전략들을 만들었나?

1. **Buy-and-Hold**:
   - 기준선 (Baseline)
   - 모든 전략은 이것보다 나아야 의미 있음

2. **Long-Only**:
   - 기본 전략 (공매도 없이 매수만)
   - 실제로 많은 투자자가 사용
   - 하락장 회피 효과 검증

3. **Long-Short**:
   - 최대 성능 테스트
   - 헤지펀드 스타일 (양방향 수익)
   - 모델의 상한선 확인

4. **Threshold 1% & 2%**:
   - 실전 적용성 중시
   - 노이즈 필터링 효과 확인
   - 거래비용 영향 최소화
   - 다양한 위험 성향 대응

### Threshold 값 책정 이유

- **0.0%**: 모든 신호 반응 (Long-Only)
- **1.0%**: 중간 확신도 (일반적 변동 범위)
- **2.0%**: 높은 확신도 (Bitcoin 일일 변동성 약 3-5%)
- **3.0% 이상**: 너무 보수적 (거래 기회 없음)

---

## ✅ 결론

### 최적 전략 선택 가이드

**공격적 투자자** (높은 리스크 감내):
- 전략: **Long-Short**
- 수익률: 188.12% (최고)
- 낙폭: -21.66% (큼)
- 조건: 공매도 가능, 낮은 거래비용

**균형 투자자** (중간 리스크):
- 전략: **Long-Only**
- 수익률: 122.56%
- 낙폭: -17.18%
- 조건: 공매도 불가, 중간 거래비용

**보수적 투자자** (낮은 리스크) ⭐ **추천**:
- 전략: **Threshold 2%**
- 수익률: 109.97%
- 낙폭: -13.34% (최소!)
- 조건: 월 1회 거래, 거래비용 영향 최소
- 장점: 심리적 안정, 실전 적용 용이

---

**작성일**: 2025년 11월 12일
**작성자**: Claude Code & 송성원
**코드 파일**: step26_elasticnet_backtesting_v2.py
